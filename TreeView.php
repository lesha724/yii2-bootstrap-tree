<?php

namespace lesha724\bootstraptree;
use yii\helpers\Html;
use yii\helpers\Json;
use yii\web\JsExpression;
use yii\web\View;

/**
 * This is just an example.
 */
class TreeView extends \yii\base\Widget
{
    public static $autoIdPrefix = 'wbtreeview_';
    /**
     * @var array additional HTML attributes that will be rendered in the div tag.
     */
    public $htmlOptions=[];
    /**
     * @var array additional options that can be passed to the constructor of the treeview js object.
     */
    public $options=[];

    /**
     * @var array additional options that can be passed to the constructor of the treeview js object.
     */
    public $events=[];

    protected $_id;

    public function init(){
        parent::init();

        if(isset($this->htmlOptions['id']))
            $this->_id=$this->htmlOptions['id'];
        else
            $this->_id=$this->htmlOptions['id']=$this->getId();
    }

    public function run()
    {
        parent::run(); // TODO: Change the autogenerated stub

        $view = $this->getView();
        TreeViewAsset::register($view);

        $options = $this->_getEventsOptions();
        $options=$options===[]?'{}' : Json::encode($options);
        $view->registerJs('$("#' . $this->_id . '").treeview( ' .$options .')', View::POS_READY);

        return $this->_runWidget();
    }

    /**
     * @return array the javascript options
     */
    protected function _getEventsOptions()
    {
        $options=$this->options;
        foreach($this->events as $key=>$event)
        {
            $options[$key]=$_function = new JsExpression($event);
        }
        return $options;
    }

    /**
     * Вывод виджета
     * @return string html widget
     */
    protected function _runWidget()
    {
        $html = Html::beginTag('div',$this->htmlOptions);
        $html .= Html::endTag('div');

        return $html;
    }
}
